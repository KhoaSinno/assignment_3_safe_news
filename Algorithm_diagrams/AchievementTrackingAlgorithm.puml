@startuml AchievementTrackingAlgorithm

start

:Người dùng đọc bài báo >= 30 giây;
' note right
' **INPUT:** 
' - userId: string
' - articleId: string  
' - readingDuration: int (seconds)
' - category: string

' **PSEUDOCODE:**
' ```
' FUNCTION trackAchievement(userId, articleId, duration, category):
'     IF duration < 30 THEN
'         RETURN // Không đủ thời gian
'     END IF
    
'     stats = getUserStats(userId)
'     stats.articlesRead += 1
'     stats.readCategories.addUnique(category)
    
'     // Cập nhật streak
'     IF isToday(stats.lastReadDate) THEN
'         // Đã đọc hôm nay rồi, không tăng streak
'     ELSE IF isYesterday(stats.lastReadDate) THEN
'         stats.currentStreak += 1
'     ELSE
'         stats.currentStreak = 1 // Reset streak
'     END IF
    
'     stats.lastReadDate = today()
    
'     newAchievements = checkAllAchievements(stats)
'     FOR EACH achievement IN newAchievements:
'         stats.unlockedAchievements.add(achievement)
'         sendAchievementNotification(userId, achievement)
'     END FOR
    
'     saveUserStats(stats)
'     RETURN newAchievements
' END FUNCTION
' ```
' end note

:Lấy danh sách thành tựu từ Firestore;

if (Thời gian đọc báo >= 30?) then (Có)
    :Báo đã đọc += 1;
    :Thêm danh mục vào danh sách danh mục thành tựu (unique);
    
    if (Đã đọc hôm nay?) then (Có)
        :Giữ nguyên\nchuỗi đọc hiện tại;
    elseif (Đọc ngày hôm qua?) then (Có)
        :Chuỗi đọc hiện tại += 1;
    else (Không)
        :Chuỗi đọc hiện tại = 1 (reset);
    endif
    
    :Lần cuối đọc = Thời gian hiện tại;
    
    :Kiểm tra điều kiện để đáp ứng tất cả thành tựu;
    ' note right
    ' **Achievement Conditions:**
    ' - NEWBIE: Mặc định khi đăng ký
    ' - FIRST_READ: articlesRead >= 1
    ' - DAILY_READER: articlesRead >= 5 trong ngày
    ' - EXPLORER: readCategories.length >= 3
    ' - WEEK_STREAK: currentStreak >= 7
    ' - BOOKWORM: articlesRead >= 50
    ' end note
    
    if (Có thành tựu mới?) then (Có)
        :Thêm vào danh sách thành tựu đã mở khóa;
        :Gửi thông báo;
        :Cập nhật UI huy hiệu tương ứng;
    endif
    
    :Lưu thông tin vào Firestore;
    :Trả về danh sách thành tựu mới;
    
else (Không)
    :Không theo dõi (< 30s);
endif

stop

@enduml


' Thuật toán theo dõi thành tựu trong ứng dụng Safe News khuyến khích người dùng đọc tin tức thường xuyên bằng cách thưởng điểm cho hành vi tích cực. Khi người dùng đọc bài báo ít nhất 30 giây, hệ thống cập nhật số bài đã đọc, chủ đề khám phá, và chuỗi đọc hàng ngày: giữ nguyên nếu đã đọc trong ngày, tăng nếu đọc liên tiếp từ hôm trước, hoặc đặt lại về 1 nếu bị gián đoạn. Sau đó, thuật toán kiểm tra và mở khóa thành tựu dựa trên số bài đọc và danh mục, gửi thông báo, cập nhật giao diện, và lưu dữ liệu vào Firestore. Cơ chế này tăng tương tác, khuyến khích đa dạng nội dung, và đồng bộ dữ liệu theo thời gian thực.