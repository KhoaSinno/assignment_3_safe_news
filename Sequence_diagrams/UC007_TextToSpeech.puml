@startuml UC007_TextToSpeech

actor "Người dùng" as user
boundary "UI: Chi tiết bài báo" as ui_detail
control "Ctrl: Text-to-Speech" as ctrl_tts
control "Ctrl: Quản lý âm thanh" as ctrl_audio
entity "Dịch vụ TTS hệ thống" as tts_engine


== Bắt đầu đọc bài báo ==
activate user
activate ui_detail
user -> ui_detail: Nhấn biểu tượng loa
ui_detail -> ctrl_tts: Yêu cầu đọc

activate ctrl_tts
ctrl_tts -> ctrl_tts: Kiểm tra tính khả dụng TTS

alt#Gold #Pink TTS không khả dụng
    ctrl_tts --> ui_detail: "TTS không được hỗ trợ"
    ui_detail --> user: Hiển thị thông báo lỗi
else #LightBlue TTS khả dụng
    ctrl_tts -> ctrl_tts: Kiểm tra nội dung bài báo
    
    alt #Orange Nội dung trống
        ctrl_tts --> ui_detail: "Không có nội dung để đọc"
deactivate ctrl_tts
        ui_detail --> user: Hiển thị thông báo
        deactivate ctrl_tts
    else #LightGreen Có nội dung
        ctrl_tts -> ctrl_audio: Dừng tất cả âm thanh\nđang phát
activate ctrl_tts
        activate ctrl_audio
        ctrl_audio --> ctrl_tts: Âm thanh đã dừng
        deactivate ctrl_audio
        
        ctrl_tts -> tts_engine: Chuẩn bị đọc nội dung
        activate tts_engine
        tts_engine --> ctrl_tts: Sẵn sàng đọc
        
        ctrl_tts -> tts_engine: Bắt đầu đọc nội dung
        tts_engine --> user: Phát âm thanh bài báo
        
        ctrl_tts --> ui_detail: Cập nhật giao diện\n(nút dừng/tạm dừng)
deactivate ctrl_tts     
        ui_detail --> user: Hiển thị điều khiển TTS
        == Điều khiển trong khi đọc ==
        
        opt Người dùng muốn tạm dừng/phát âm thanh
            user -> ui_detail: Nhấn nút tạm dừng/phát
            ui_detail -> ctrl_tts: Yêu cầu tạm dừng/phát
activate ctrl_tts
            ctrl_tts -> tts_engine: Tạm dừng/phát 
            tts_engine --> ctrl_tts: Xác nhận tạm dừng/phát
            ctrl_tts --> ui_detail: Cập nhật trạng thái
deactivate ctrl_tts
            ui_detail --> user: Hiển thị trạng thái
        end
       
        deactivate tts_engine
        
    end
end

deactivate ui_detail
deactivate user

@enduml
