@startuml UC006_PushNotification

actor "Người dùng" as user
boundary "UI: Cài đặt thông báo" as ui_settings
boundary "UI: Thông báo hệ thống" as ui_notification
boundary "UI: Chi tiết bài báo" as ui_detail
control "Ctrl: Cài đặt người dùng" as ctrl_settings
control "Ctrl: Lập lịch/Xử lý thông báo" as ctrl_scheduler
entity "Database" as database

== Cấu hình thông báo ==

activate user
user -> ui_settings: Vào cài đặt thông báo

activate ui_settings
ui_settings -> ctrl_settings: Yêu cầu cấu hình hiện tại
activate ctrl_settings
ctrl_settings -> database: Lấy cài đặt thông báo
activate database
database --> ctrl_settings: Cài đặt hiện tại
deactivate database
ctrl_settings --> ui_settings: Cài đặt thông báo
deactivate ctrl_settings
ui_settings --> user: Hiển thị giao diện cài đặt

user -> ui_settings: Chọn danh mục muốn nhận thông báo
ui_settings -> ctrl_settings: Lưu cài đặt thông báo mới
activate ctrl_settings
ctrl_settings -> database: Cập nhật cài đặt
activate database
database --> ctrl_settings: Xác nhận lưu thành công
deactivate database
ctrl_settings --> ui_settings: Thông báo thành công
deactivate ctrl_settings
ui_settings --> user: "Cài đặt đã được lưu"
deactivate ui_settings

== Hệ thống gửi thông báo tự động ==

ctrl_scheduler -> ctrl_scheduler: Kích hoạt mỗi 2 giờ
activate ctrl_scheduler
ctrl_scheduler -> ctrl_scheduler: Kiểm tra tin tức mới
ctrl_scheduler -> ctrl_scheduler: Lấy tin tức mới nhất
ctrl_scheduler -> database: Kiểm tra tin tức đã thông báo
activate database
database --> ctrl_scheduler: Danh sách tin tức
deactivate database
ctrl_scheduler -> ctrl_scheduler: Lọc tin mới chưa thông báo

ctrl_scheduler -> ctrl_scheduler: Gọi API xử lý tin tức\nvà thông báo cho người dùng


deactivate ctrl_scheduler

== Người dùng nhận và xử lý thông báo ==

ctrl_scheduler --> ui_notification: Hiển thị thông báo trên thiết bị
activate ui_notification
ui_notification --> user: Thông báo tin tức mới

alt#Gold #Pink Người dùng không tương tác
    ui_notification -> ui_notification: Thông báo tự động biến mất
else #LightBlue Người dùng nhấn thông báo
    user -> ui_notification: Nhấn vào thông báo
    ui_notification -> ui_detail: Chuyển đến chi tiết bài báo
    deactivate ui_notification
    activate ui_detail
    ui_detail --> user: Hiển thị nội dung bài báo
    deactivate ui_detail
end

deactivate user

@enduml
